language: java
jdk: oraclejdk8
services:
  - redis-server

before_install:
- git config --global user.name "Goodow Bot"
- git config --global user.email "dev@goodow.com"
- cd bower-realtime-store && git pull origin gh-pages && git remote set-url origin "https://${GH_TOKEN}@github.com/goodow/bower-realtime-store.git"
- cd ${TRAVIS_BUILD_DIR}
- wget -P target/travis https://raw.githubusercontent.com/goodow/maven/master/settings.xml
- curl http://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -
- echo "deb http://packages.elasticsearch.org/elasticsearch/1.2/debian stable main" | sudo tee -a /etc/apt/sources.list
- sudo apt-get update -qq
- sudo apt-get install elasticsearch && sudo service elasticsearch start

script:
- mvn test -B
- ./gwt-compile.sh

after_success:
- cd bower-realtime-store && git commit -a -m "Generated by goodow/realtime-store@${TRAVIS_COMMIT}" && git push origin HEAD:gh-pages
- cd ${TRAVIS_BUILD_DIR}
- '[ ${TRAVIS_PULL_REQUEST} = ''false'' ] && mvn deploy -Psonatype-oss-release -Dgpg.skip=true
  --settings target/travis/settings.xml || mvn verify --settings target/travis/settings.xml'

env:
  global:
    - secure: GKYojWRCCHigM4YaccAnRjHJMm/POM615suzeNX3/Bt4y2wh9gaOvboZs4ybjtQ0TUF+OVQOI3gETqDB+HvF9qsW8LmpRu5Eo05xoDkvtWFkZOd1JOTHwGlmAHYXLoINHHB6o4KgK62BNeUvxGI/anLh+IgZzXKJKZGdz1yJd+s=